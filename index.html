<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Vistoria de Hidrantes</title>
<style>
body { font-family: Arial, sans-serif; }
.hidrante { cursor: pointer; padding: 8px 12px; border: 1px solid #333; margin: 5px; display:inline-block; border-radius:4px; }
.hidrante.vistoriado { background-color: green; color: white; }
#formModal { display:none; position:fixed; top:10%; left:50%; transform:translateX(-50%); background:#fff; padding:20px; border:2px solid #000; max-width:500px; z-index:1000; box-shadow:0 0 10px rgba(0,0,0,0.5); }
.mangueira { margin-bottom: 15px; padding: 8px; border:1px dashed #888; }
.subperguntas { margin-left: 15px; margin-top: 5px; }
button { margin-top: 5px; }
</style>
</head>
<body>

<h2>Vistoria de Hidrantes</h2>

<label>Nome do vistoriador:</label>
<input type="text" id="vistoriadorNome"><br><br>

<div id="hidrantesList"></div>

<!-- Modal Formulário -->
<div id="formModal">
  <h3 id="modalTitulo"></h3>
  <p id="modalDescricao"></p>

  <form id="formHidrante">
    <div id="mangueiras-container"></div>
    <button type="button" id="addMangueira">+ Adicionar mangueira</button><br><br>

    <label>Esguicho presente?</label>
    <select name="esguichoPresente">
      <option value="-">-</option>
      <option value="Sim">Sim</option>
      <option value="Não">Não</option>
    </select><br>

    <label>Tipo de esguicho:</label>
    <select name="tipoEsguicho">
      <option value="-">-</option>
      <option value="Regulável">Regulável</option>
      <option value="Agulheta">Agulheta</option>
    </select><br>

    <label>Chave storz presente?</label>
    <select name="chaveStorz">
      <option value="-">-</option>
      <option value="Sim">Sim</option>
      <option value="Não">Não</option>
    </select><br>

    <label>Observações</label>
    <textarea name="observacoes" rows="2"></textarea><br>

    <label>Situação final</label>
    <select name="situacaoFinal">
      <option value="-">-</option>
      <option value="Conforme">Conforme</option>
      <option value="Não Conforme">Não Conforme</option>
    </select><br>

    <label>Equipe:</label>
    <select name="equipe">
      <option value="-">-</option>
      <option value="Alfa">Alfa</option>
      <option value="Bravo">Bravo</option>
      <option value="Charlie">Charlie</option>
      <option value="Delta">Delta</option>
    </select><br><br>

    <button type="submit">Enviar</button>
    <button type="button" id="cancelar">Cancelar</button>
  </form>
</div>

<script>
// Configuração dos hidrantes (01 a 22)
const hidrantesConfig = {};
for(let i=1;i<=22;i++){
  const num = i.toString().padStart(2,"0");
  hidrantesConfig[num] = { quantidade: 2, tipo: "2", polegada: "1 1/2\"", tamanho: "20", descricao: `Hidrante ${num} descrição` };
}

// Gerar lista de hidrantes
const hidrantesListDiv = document.getElementById("hidrantesList");
Object.keys(hidrantesConfig).forEach(num=>{
  const div = document.createElement("div");
  div.classList.add("hidrante");
  div.dataset.numero = num;
  div.dataset.edificacao = `Edificação ${num}`;
  div.dataset.descricao = hidrantesConfig[num].descricao;
  div.innerText = `Hidrante ${num}`;
  hidrantesListDiv.appendChild(div);
});

// Variável global do hidrante selecionado
let hidranteAtual = null;

// Clique no hidrante
document.querySelectorAll(".hidrante").forEach(el=>{
  el.addEventListener("click", function(){
    const nome = document.getElementById("vistoriadorNome").value.trim();
    if(!nome){ alert("Informe o nome do vistoriador!"); return; }

    hidranteAtual = el;
    const numero = el.dataset.numero;
    const edificacao = el.dataset.edificacao;
    const descricao = el.dataset.descricao;

    document.getElementById("modalTitulo").innerText = `Hidrante ${numero}`;
    document.getElementById("modalDescricao").innerText = `Edificação: ${edificacao}\nDescrição: ${descricao}`;

    const container = document.getElementById("mangueiras-container");
    container.innerHTML = "";
    adicionarBlocoMangueira(numero);

    document.getElementById("formModal").style.display = "block";
  });
});

// Adicionar bloco mangueira
function adicionarBlocoMangueira(numero){
  const config = hidrantesConfig[numero];
  const container = document.getElementById("mangueiras-container");
  const count = container.querySelectorAll(".mangueira").length + 1;

  const bloco = document.createElement("div");
  bloco.classList.add("mangueira");
  bloco.innerHTML = `
    <label>Possui ${config.quantidade} mangueiras do Tipo ${config.tipo} de ${config.polegada} de ${config.tamanho} m?</label>
    <select name="possuiMangueira">
      <option value="-">-</option>
      <option value="Sim">Sim</option>
      <option value="Não">Não</option>
    </select><br>
    <div class="subperguntas" style="display:none;">
    <h4>Mangueira ${count}</h4>
      <label>1.1 Tipo:</label>
      <select name="tipoMangueira">
        <option value="-">-</option>
        <option value="2">Tipo 2</option>
        <option value="3">Tipo 3</option>
        <option value="4">Tipo 4</option>
      </select><br>
      <label>1.2 Comprimento:</label>
      <select name="comprimentoMangueira">
        <option value="-">-</option>
        <option value="15">15 m</option>
        <option value="20">20 m</option>
        <option value="30">30 m</option>
      </select><br>
      <label>1.3 Polegada:</label>
      <select name="polegadaMangueira">
        <option value="-">-</option>
        <option value='1 1/2"'>1 ½"</option>
        <option value='2 1/2"'>2 ½"</option>
      </select><br>
      <button type="button" class="copiarPrimeira">Copiar da 1ª mangueira</button>
    </div>
  `;
  container.appendChild(bloco);

  // Mostra/oculta subperguntas
  bloco.querySelector("select[name='possuiMangueira']").addEventListener("change", function(){
    if(this.value === "Não"){ bloco.querySelector(".subperguntas").style.display="block"; }
    else{ bloco.querySelector(".subperguntas").style.display="none"; }
  });

  // Copiar dados da primeira mangueira
  bloco.querySelector(".copiarPrimeira")?.addEventListener("click", function(){
    const primeira = container.querySelector(".mangueira");
    const primeiraValues = {};
    primeira.querySelectorAll("select").forEach(el=>primeiraValues[el.name]=el.value);
    bloco.querySelectorAll("select").forEach(el=>{ if(primeiraValues[el.name]) el.value=primeiraValues[el.name]; });
  });
}

// Botão adicionar mangueira extra
document.getElementById("addMangueira").addEventListener("click", function(){
  const numero = hidranteAtual.dataset.numero;
  adicionarBlocoMangueira(numero);
});

// Cancelar
document.getElementById("cancelar").addEventListener("click", ()=>document.getElementById("formModal").style.display="none");

// Enviar formulário
document.getElementById("formHidrante").addEventListener("submit", async function(e){
  e.preventDefault();
  const form = e.target;
  const numero = hidranteAtual.dataset.numero;
  const edificacao = hidranteAtual.dataset.edificacao;
  const descricao = hidranteAtual.dataset.descricao;

  const mangueiras = [];
  document.querySelectorAll(".mangueira").forEach(bloco=>{
    const possui = bloco.querySelector("select[name='possuiMangueira']").value || "-";
    const sub = bloco.querySelector(".subperguntas");
    let tipo="-", comprimento="-", polegada="-";
    if(possui==="Não"){
      tipo=sub.querySelector("select[name='tipoMangueira']").value || "-";
      comprimento=sub.querySelector("select[name='comprimentoMangueira']").value || "-";
      polegada=sub.querySelector("select[name='polegadaMangueira']").value || "-";
    } else {
      const conf = hidrantesConfig[numero];
      tipo = conf.tipo; comprimento=conf.tamanho; polegada=conf.polegada;
    }
    mangueiras.push({possui,tipo,comprimento,polegada});
  });

  const dadosFormulario = {
    numero, edificacao, descricao,
    mangueiras,
    esguichoPresente: form.esguichoPresente.value || "-",
    tipoEsguicho: form.tipoEsguicho.value || "-",
    chaveStorz: form.chaveStorz.value || "-",
    observacoes: form.observacoes.value || "-",
    situacaoFinal: form.situacaoFinal.value || "-",
    dataVistoria: new Date().toISOString(),
    vistoriador: document.getElementById("vistoriadorNome").value,
    equipe: form.equipe.value || "-"
  };

  // Enviar para Apps Script
  const url = "COLE_AQUI_SEU_URL_WEBAPP"; // Substitua pelo seu URL do Apps Script
  try{
    const res = await fetch(url, { method:"POST", body: JSON.stringify(dadosFormulario) });
    const json = await res.json();
    if(json.status==="ok"){
      hidranteAtual.classList.add("vistoriado");
      document.getElementById("formModal").style.display="none";
      alert("Vistoria salva com sucesso!");
    } else { alert("Erro ao salvar: "+json.mensagem); }
  } catch(err){ alert("Erro ao enviar: "+err.message); }
});
</script>

</body>
</html>
